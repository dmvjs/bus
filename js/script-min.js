var WMATA={ll:[],currentLines:[],getPosition:function(){"use strict";function t(t){WMATA.ll=[t.coords.latitude,t.coords.longitude],console.log("attempt"),void 0===WMATA.stops?WMATA.getStops():WMATA.getStopPrediction()}window.navigator.geolocation?window.navigator.geolocation.getCurrentPosition(t,function(){alert("This device requires geolocation. Please enable and refresh.")}):window.alert("This device does not allow geolocation, which is required for this application.")},getStops:function(){WMATA.pureAjax("http://api.wmata.com/Bus.svc/json/JStops?lat="+WMATA.ll[0]+"&lon="+WMATA.ll[1]+"&radius=500&api_key="+WMATA.key+"&callback=WMATA.gotStops")},gotStops:function(t){WMATA.stops=t,WMATA.computeNearestStop(),WMATA.getStopPrediction()},getStopPrediction:function(){WMATA.pureAjax("http://api.wmata.com/NextBusService.svc/json/JPredictions?StopID="+WMATA.closestStop.StopID+"&api_key="+WMATA.key+"&callback=WMATA.gotStopPrediction")},gotStopPrediction:function(t){WMATA.stopPredictions=t,WMATA.displayResults(),WMATA.getBusPositions()},getBusPositions:function(){WMATA.pureAjax("http://api.wmata.com/Bus.svc/json/JBusPositions?routeId="+WMATA.stops.Stops[0].Routes[0]+"&includingVariations=true&api_key="+WMATA.key+"&callback=WMATA.gotBusPositions")},gotBusPositions:function(t){WMATA.busPositions=t,WMATA.displayBusPositions()},computeNearestStop:function(){"use strict";var t,o,e,s,i,n,a,c,A,d,p=[-1,2e4],r=window.document.getElementById("stop"),u=6371;for(d=0;WMATA.stops.Stops.length>d;d+=1)t=WMATA.ll[0],e=WMATA.stops.Stops[d].Lat,o=WMATA.ll[1],s=WMATA.stops.Stops[d].Lon,i=(e-t)*Math.PI/180,n=(s-o)*Math.PI/180,t=t*Math.PI/180,e=e*Math.PI/180,a=Math.sin(i/2)*Math.sin(i/2)+Math.sin(n/2)*Math.sin(n/2)*Math.cos(t)*Math.cos(e),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),A=u*c,p[1]>A&&(p=[d,A]);WMATA.closestStop=WMATA.stops.Stops[p[0]],window.document.title="WMATA "+WMATA.stops.Stops[p[0]].Name+" Stop",r.innerText=WMATA.stops.Stops[p[0]].Name,r.textContent=WMATA.stops.Stops[p[0]].Name},computeBusPosition:function(t){"use strict";var o,e,s,i,n,a,c,A,d,p,r=[-1,2e4],u=window.document.getElementById("position"),l=6371,M=1===parseInt(Math.abs(t.Deviation).toFixed(0),10)?" minute ":" minutes ",T=(parseFloat(t.Deviation)>0?M+"ahead of ":M+"behind ")+"schedule.",h=Math.abs(t.Deviation).toFixed(0),m=0===h?"It is currently on time.":"It is running about ";for(p=0;WMATA.stops.Stops.length>p;p+=1)o=t.Lat,s=WMATA.stops.Stops[p].Lat,e=t.Lon,i=WMATA.stops.Stops[p].Lon,n=(s-o)*Math.PI/180,a=(i-e)*Math.PI/180,o=o*Math.PI/180,s=s*Math.PI/180,c=Math.sin(n/2)*Math.sin(n/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(s),A=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),d=l*A,r[1]>d&&(r=[p,d]);console.log(t),u.innerHTML="The next bus was "+(.621371*d).toFixed(0)+" mile"+(1===parseInt((.621371*d).toFixed(0),10)?"":"s")+" away near "+WMATA.stops.Stops[r[0]].Name+" as of "+WMATA.computeTime(t.DateTime.split("T")[1])+". "+m+(h>0?h:"")+T},computeTime:function(t){var o=new Date,e=o.getHours(),s=o.getMinutes(),i=t.split(":"),n=parseInt(i[0],10),a=parseInt(i[1],10),c="",A="";return s>a&&(c+=s-a+" minute"+(1===parseInt(s-a,10)?"":"s")),e>n&&(""!==c&&(A=", "),c+=A+e-n+" hour"+(1===parseInt(e-n,10)?"":"s")),""===c?c="just now":c+=" ago",c},displayResults:function(){"use strict";var t,o,e,s,i=window.document.getElementById("schedule"),n=["RouteID","DirectionText","Minutes"],a=window.document.createElement("table"),c=window.document.createElement("thead"),A=window.document.createElement("tbody"),d='<tr><th class="th1">RTE</th><th class="th2">DIRECTION</th><th class="th3">MIN</th></tr>';for(null!==window.document.getElementById("table1")&&i.removeChild(window.document.getElementById("table1")),c.id="thead1",c.innerHTML=d,a.id="table1",a.appendChild(c),e=0;WMATA.stopPredictions.Predictions.length>e;e+=1){for(t=window.document.createElement("tr"),t.className="row",s=0;n.length>s;s+=1)o=window.document.createElement("td"),0===s?o.appendChild(window.document.createTextNode(WMATA.stops.Stops[s].Routes[0])):o.appendChild(window.document.createTextNode(WMATA.stopPredictions.Predictions[e][n[s]])),o.className="cell"+(s+1),t.appendChild(o);A.appendChild(t)}a.appendChild(A),i.appendChild(a),window.setTimeout(function(){WMATA.getPosition()},3e4),void 0===WMATA.rainbow&&(/mobile/i.test(navigator.userAgent)&&setTimeout(function(){window.scrollTo(0,1)},200),WMATA.rainbow="unicorn")},displayBusPositions:function(){var t,o=window.document.getElementById("position"),e=0;for(e=0;WMATA.busPositions.BusPositions.length>e;e+=1)WMATA.busPositions.BusPositions[e].VehicleID===WMATA.stopPredictions.Predictions[0].VehicleID&&(t=WMATA.busPositions.BusPositions[e]);void 0===t?o.innerHTML="The next bus is not reporting its location at this time.":WMATA.computeBusPosition(t)},pureAjax:function(t){"use strict";var o=window.document.createElement("script");o.src=t,o.async=!0,window.document.body.appendChild(o)},key:"e8apbxn8jucqbk7bvv2wn2qm"};(function(){"use strict";WMATA.getPosition()})();