var WMATA={ll:[],currentLines:[],getPosition:function(){"use strict";function t(t){WMATA.ll=[t.coords.latitude,t.coords.longitude],console.log("attempt"),void 0===WMATA.stops?WMATA.getStops():WMATA.getStopPrediction()}window.navigator.geolocation?window.navigator.geolocation.getCurrentPosition(t,function(){alert("This device requires geolocation")}):window.alert("This device does not allow geolocation")},getStops:function(){WMATA.pureAjax("http://api.wmata.com/Bus.svc/json/JStops?lat="+WMATA.ll[0]+"&lon="+WMATA.ll[1]+"&radius=500&api_key="+WMATA.key+"&callback=WMATA.gotStops")},gotStops:function(t){WMATA.stops=t,WMATA.computeNearestStop(),WMATA.getStopPrediction()},getStopPrediction:function(){WMATA.pureAjax("http://api.wmata.com/NextBusService.svc/json/JPredictions?StopID="+WMATA.closestStop.StopID+"&api_key="+WMATA.key+"&callback=WMATA.gotStopPrediction")},gotStopPrediction:function(t){WMATA.stopPredictions=t,WMATA.displayResults(),WMATA.getBusPositions()},getBusPositions:function(){WMATA.pureAjax("http://api.wmata.com/Bus.svc/json/JBusPositions?routeId="+WMATA.stops.Stops[0].Routes[0]+"&includingVariations=true&api_key="+WMATA.key+"&callback=WMATA.gotBusPositions")},gotBusPositions:function(t){WMATA.busPositions=t,WMATA.displayBusPositions()},computeNearestStop:function(){"use strict";var t,o,e,n,s,i,a,c,A,d,r=[-1,2e4],u=window.document.getElementById("stop"),l=6371;for(d=0;WMATA.stops.Stops.length>d;d+=1)t=WMATA.ll[0],e=WMATA.stops.Stops[d].Lat,o=WMATA.ll[1],n=WMATA.stops.Stops[d].Lon,s=(e-t)*Math.PI/180,i=(n-o)*Math.PI/180,t=t*Math.PI/180,e=e*Math.PI/180,a=Math.sin(s/2)*Math.sin(s/2)+Math.sin(i/2)*Math.sin(i/2)*Math.cos(t)*Math.cos(e),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),A=l*c,r[1]>A&&(r=[d,A]);WMATA.closestStop=WMATA.stops.Stops[r[0]],window.document.title="WMATA "+WMATA.stops.Stops[r[0]].Name+" Stop",u.innerText=WMATA.stops.Stops[r[0]].Name,u.textContent=WMATA.stops.Stops[r[0]].Name},computeBusPosition:function(t){"use strict";var o,e,n,s,i,a,c,A,d,r,u=[-1,2e4],l=window.document.getElementById("position"),p=6371,M=1===parseInt(Math.abs(t.Deviation).toFixed(0),10)?" minute ":" minutes ",T=(parseFloat(t.Deviation)>0?M+"ahead of ":M+"behind ")+"schedule.",h=Math.abs(t.Deviation).toFixed(0),m=0===h?"It is currently on time.":"It is running about ";for(r=0;WMATA.stops.Stops.length>r;r+=1)o=t.Lat,n=WMATA.stops.Stops[r].Lat,e=t.Lon,s=WMATA.stops.Stops[r].Lon,i=(n-o)*Math.PI/180,a=(s-e)*Math.PI/180,o=o*Math.PI/180,n=n*Math.PI/180,c=Math.sin(i/2)*Math.sin(i/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(o)*Math.cos(n),A=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),d=p*A,u[1]>d&&(u=[r,d]);console.log(t),l.innerHTML="The next bus was "+(.621371*d).toFixed(0)+" mile"+(1===parseInt((.621371*d).toFixed(0),10)?"":"s")+" away near "+WMATA.stops.Stops[u[0]].Name+" as of "+WMATA.computeTime(t.DateTime.split("T")[1])+". "+m+(h>0?h:"")+T},computeTime:function(t){var o=new Date,e=o.getHours(),n=o.getMinutes(),s=t.split(":"),i=parseInt(s[0],10),a=parseInt(s[1],10),c="",A="";return n>a&&(c+=n-a+" minute"+(1===parseInt(n-a,10)?"":"s")),e>i&&(""!==c&&(A=", "),c+=A+e-i+" hour"+(1===parseInt(e-i,10)?"":"s")),""===c?c="just now":c+=" ago",c},displayResults:function(){"use strict";var t,o,e,n,s=window.document.getElementById("schedule"),i=["RouteID","DirectionText","Minutes"],a=window.document.createElement("table"),c=window.document.createElement("thead"),A=window.document.createElement("tbody"),d='<tr><th class="th1">RTE</th><th class="th2">DIRECTION</th><th class="th3">MIN</th></tr>';for(null!==window.document.getElementById("table1")&&s.removeChild(window.document.getElementById("table1")),c.id="thead1",c.innerHTML=d,a.id="table1",a.appendChild(c),e=0;WMATA.stopPredictions.Predictions.length>e;e+=1){for(t=window.document.createElement("tr"),n=0;i.length>n;n+=1)o=window.document.createElement("td"),0===n?o.appendChild(window.document.createTextNode(WMATA.stops.Stops[n].Routes[0])):o.appendChild(window.document.createTextNode(WMATA.stopPredictions.Predictions[e][i[n]])),o.className="cell"+(n+1),t.appendChild(o);A.appendChild(t)}a.appendChild(A),s.appendChild(a),WMATA.rainbowify(),window.setTimeout(function(){WMATA.getPosition()},3e4)},displayBusPositions:function(){var t,o=window.document.getElementById("position"),e=0;for(e=0;WMATA.busPositions.BusPositions.length>e;e+=1)WMATA.busPositions.BusPositions[e].VehicleID===WMATA.stopPredictions.Predictions[0].VehicleID&&(t=WMATA.busPositions.BusPositions[e]);void 0===t?o.innerHTML="The next bus is not reporting its location at this time.":WMATA.computeBusPosition(t)},rainbowify:function(){"use strict";var t,o=0,e=0,n=window.document.getElementById("table1"),s=window.document.getElementsByClassName("cell1");for(o=1;n.rows.length>o;o+=1)t=n.rows[o],t.className="row row"+o;for(e=0;s.length>e;e+=1)s[e].id=void 0!==s[e].innerText?s[e].innerText:s[e].textContent;void 0===WMATA.rainbow&&(/mobile/i.test(navigator.userAgent)&&setTimeout(function(){window.scrollTo(0,1)},200),WMATA.rainbow="unicorn")},pureAjax:function(t){"use strict";var o=window.document.createElement("script");o.src=t,o.async=!0,window.document.body.appendChild(o)},key:"e8apbxn8jucqbk7bvv2wn2qm"};(function(){"use strict";WMATA.getPosition()})();